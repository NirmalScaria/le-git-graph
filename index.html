<!DOCTYPE html>
<html>
<head>
  <title>Git Graph</title>
  <meta charset="UTF-8">
  <style>
    #graph-container {
      display: flex;
    }
    #graphSvg {
      /* width: 200px; */ /* Let JS control the width */
      min-width: 100px; /* Set a minimum width */
      margin-right: 10px; /* Adjust the gap to the right */
    }
    .commit-item {
      height: 50px; /* Corresponds to yPos logic */
      border-bottom: 1px solid #eee;
      padding-left: 10px;
      display: flex;
      align-items: center;
    }
  </style>
</head>
<body>

<h1>Git Graph Visualization</h1>

<div id="graph-container">
  <svg id="graphSvg"></svg>
  <div id="commits-container">
  </div>
</div>

<script src="git-graph.js?v=final_correct_layout"></script>
<script>
  // 1. Define sample data
  const heads = [
      { id: 'c4', name: 'feature-a' }
  ];

  let commits = [
    { id: 'c1', content: '1 Root commit', parents: [], group: 'base' },
    { id: 'c2', content: '1-2 Initial commit on main', parents: ['c1'], group: 'base' },
    { id: 'c3', content: '1-3 Work on feature-a', parents: ['c1'], group: 'release' },
    { id: 'c4', content: '2-4 Add new feature', parents: ['c2'], group: 'base', isHead: true },
    { id: 'c5', content: '3-5 Update main', parents: ['c3'], group: 'hotfix' },
    { id: 'c6', content: '5-6 Update main', parents: ['c5'], group: 'hotfix' },
    { id: 'c7', content: '6-7 Update main', parents: ['c6'], group: 'hotfix' },
    { id: 'c8', content: '[2,7]-8Update main', parents: ['c2', 'c7'], group: 'hotfix' },
    { id: 'c9', content: '3-9 Update main', parents: ['c3'], group: 'hotfix' },
    { id: 'c10', content: '4-10 Update main', parents: ['c4'], group: 'base' },
    { id: 'c11', content: '10-11 Update main', parents: ['c10'], group: 'base' },
    { id: 'c12', content: '8-12 Update main', parents: ['c8'], group: 'base' },
    { id: 'c13', content: '4-13 Update main', parents: ['c10'], group: 'base' }
  ];

  // 2. Populate the commit list on the right
  const commitsContainer = document.getElementById('commits-container');
  [...commits].reverse().forEach(commit => {
    const commitItem = document.createElement('div');
    commitItem.className = 'commit-item';
    commitItem.setAttribute('commit-id', commit.id);
    commitItem.setAttribute('group', commit.group);
    commitItem.innerText = commit.content;
    commitsContainer.appendChild(commitItem);
  });

  // 3. Set SVG height to match the list and get scene data
  const svgGraph = document.getElementById('graphSvg');
  svgGraph.style.height = `${commitsContainer.offsetHeight}px`;
  const [renderLines, totalRows] = assignColors(commits, heads);

  // 4. Update commit item colors to match the dynamically assigned graph colors
  for (const commit of commits) {
    const commitItem = commitsContainer.querySelector(`[commit-id="${commit.id}"]`);
    if (commitItem) {
      commitItem.style.color = commit.color;
    }
  }

  // 5. Render the scene
  drawGraph(renderLines, totalRows, commitsContainer.offsetHeight);
</script>

</body>
</html>