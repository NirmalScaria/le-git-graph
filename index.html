<!DOCTYPE html>
<html>
<head>
  <title>Git Graph</title>
  <meta charset="UTF-8">
  <style>
    #graph-container {
      display: flex;
    }
    #graphSvg {
      /* width: 200px; */ /* Let JS control the width */
      min-width: 100px; /* Set a minimum width */
      margin-right: 10px; /* Adjust the gap to the right */
    }
    .commit-item {
      height: 50px; /* Corresponds to yPos logic */
      border-bottom: 1px solid #eee;
      padding-left: 10px;
      display: flex;
      align-items: center;
    }
  </style>
</head>
<body>

<h1>Git Graph Visualization</h1>

<div id="graph-container">
  <svg id="graphSvg"></svg>
  <div id="commits-container">
  </div>
</div>

<script src="git-graph.js?v=final_correct_layout"></script>
<script>
  // 1. Define sample data
  const heads = [
      { oid: 'c4', name: 'feature-a' }
  ];

  let commits = [
    { oid: 'c1', messageHeadlineHTML: '1 Root commit', parents: [], group: 'base' },
    { oid: 'c2', messageHeadlineHTML: '1-2 Initial commit on main', parents: [{ node: { oid: 'c1' } }], group: 'base' },
    { oid: 'c3', messageHeadlineHTML: '1-3 Work on feature-a', parents: [{ node: { oid: 'c1' } }], group: 'release' },
    { oid: 'c4', messageHeadlineHTML: '2-4 Add new feature', parents: [{ node: { oid: 'c2' } }], group: 'base', isHead: true },
    { oid: 'c5', messageHeadlineHTML: '3-5 Update main', parents: [{ node: { oid: 'c3' } }], group: 'hotfix' },
    { oid: 'c6', messageHeadlineHTML: '5-6 Update main', parents: [{ node: { oid: 'c5' } }], group: 'hotfix' },
    { oid: 'c7', messageHeadlineHTML: '6-7 Update main', parents: [{ node: { oid: 'c6' } }], group: 'hotfix' },
    { oid: 'c8', messageHeadlineHTML: '[2,7]-8Update main', parents: [{ node: { oid: 'c2' } },{ node: { oid: 'c7' } }], group: 'hotfix' },
    { oid: 'c9', messageHeadlineHTML: '3-9 Update main', parents: [{ node: { oid: 'c3' } }], group: 'hotfix' },
    { oid: 'c10', messageHeadlineHTML: '4-10 Update main', parents: [{ node: { oid: 'c4' } }], group: 'base' },
    { oid: 'c11', messageHeadlineHTML: '10-11 Update main', parents: [{ node: { oid: 'c10' } }], group: 'base' },
    { oid: 'c12', messageHeadlineHTML: '8-12 Update main', parents: [{ node: { oid: 'c8' } }], group: 'base' },
    { oid: 'c13', messageHeadlineHTML: '4-13 Update main', parents: [{ node: { oid: 'c10' } }], group: 'base' }
  ];

  // 2. Populate the commit list on the right
  const commitsContainer = document.getElementById('commits-container');
  [...commits].reverse().forEach(commit => {
    const commitItem = document.createElement('div');
    commitItem.className = 'commit-item';
    commitItem.setAttribute('commitsha', commit.oid);
    commitItem.setAttribute('group', commit.group);
    commitItem.innerText = commit.messageHeadlineHTML;
    commitsContainer.appendChild(commitItem);
  });

  // 3. Set SVG height to match the list and get scene data
  const svgGraph = document.getElementById('graphSvg');
  svgGraph.style.height = `${commitsContainer.offsetHeight}px`;
  const [renderLines, totalRows] = assignColors(commits, heads);

  // 4. Update commit item colors to match the dynamically assigned graph colors
  for (const commit of commits) {
    const commitItem = commitsContainer.querySelector(`[commitsha="${commit.oid}"]`);
    if (commitItem) {
      commitItem.style.color = commit.color;
    }
  }

  // 5. Render the scene
  drawGraph(renderLines, totalRows, commitsContainer.offsetHeight);
</script>

</body>
</html>